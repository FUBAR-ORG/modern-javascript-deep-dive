# 원시 값과 객체의 비교

| 타입 분류 |   원시 값    | 객체               |
| :-------: | :----------: | ------------------ |
| 변경 여부 |  변경 불가   | 변경 가능          |
| 저장 방식 | 실제 값 저장 | 참조 값(주소) 저장 |
| 전달 방식 |   값 전달    | 참조 전달          |

- 원시 값: 값에 의한 전달(`pass by value`)
- 객체: 참조에 의한 전달(`pass by reference`)

## 원시 값

### 변경 불가능한 값

> 원시 타입(`primitive type`)의 값은 변경 불가능한 값(`immutable value`).

- 값을 변경할 수 없으며, 변수는 언제든지 재할당을 통해 변수 값을 변경할 수 있음.
- 상수는 재할당이 금지된 변수.
- 원시 값은 읽기 전용(`read only`) 값.
- 원시 값은 변경 불가능하기 때문에 값을 직접 변경할 수 없으며, 변경하기 위해서 원시 값을 재할당하면 새로운 메모리 공간을 확보하고 값을 저장한 후 변수가 참조하던 메모리 공간의 주소를 변경.
  > 값의 이러한 특성을 불변성(`immutability`)라고 함.
- 값을 변경할 수 있게 되면(불변성이 사라지면) 값의 변경, 상태를 추적하기 어렵게 만듬.

### 문자열과 불변성

- 원시 값을 저장하려면 먼저 확보해야하는 메모리 공간의 크기를 결정.

  > `ECMAScript` 사양에 문자열 타입(2바이트)와 숫자 타입(8바이트) 이외의 원시 타입은 브라우저에 따라 다를 수 있음.

- 문자열은 0개 이상의 문자(`character`)로 이루어진 집합.
- 1개의 문자는 2바이트의 메모리 공간에 저장. 즉, 몇 개의 문자로 이뤄졌느냐에 따라 필요한 메모리 공간의 크기 결정.
- 다른 언어와는 달리 `JavaScript`는 원시 타입인 문자열 제공.
- 문자열은 유사 배열 객체이면서 이터러블이므로 배열과 유사하게 접근 가능.

```js
var str = "string";
str[0] = "S";
console.log(str); // "string"
```

- 문자열은 변경 불가능한 원시 타입이므로 일부 문자를 직접 변경해도 반영되지 않음.

#### 유사 배열 객체(`array-like object`)

- 마치 배열처럼 인덱스로 프로퍼티 값에 접근할 수 있고 `length` 프로퍼티를 갖는 객체.

### 값에 의한 전달

> `ECMAScript` 사양에 변수를 통해 메모리를 어떻게 관리해야 하는지 명확하게 정의되어 있지 않음.

- 공유에 의한 전달(`pass by sharing`)이라고 표현하기도 함.
- 값에 의한 전달은 `JavaScript` 용어가 아니므로 오해가 있을 수 있음.

  > 엄격하게 표현하면 변수에 값이 전달되는 것이 아니라 메모리 주소가 전달됨.

- 변수와 같은 식별자는 값이 아니라 메모리 주소를 기억.
- 식별자가 기억하고 있는 메모리 주소를 통해 메모리 공간에 저장된 값에 접근하는 방식. 즉, 식별자는 메모리 주소에 붙인 이름.

## 객체

> 브라우저마다 객체를 관리하는 방식이 다를 수 있음.

- 객체는 원시 값처럼 확보해야 할 메모리 공간의 크기를 사전에 정해 둘 수 없음.
- `JavaScript`의 객체 관리 방식
  - 객체는 프로퍼티 키를 인덱스로 사용하는 해시 테이블(`hash table`, 연관 배열, `associative array`, `map`, `dictionary`, `look up table`)처럼 보임.
  - 대부분의 `JavaScript Engine`은 해시 테이블과 유사하지만 높은 성능을 위해 일반적인 해시 테이블보다 더 나은 방법으로 객체 구현.
  - 성능 면에서 클래스 기반 언어의 객체보다 생성과 프로퍼티 접근에 비용이 더 많이 드는 비효율적인 방식.
  - `V8 JavaScript Engine`에서는 동적 탐색(`dynamic lookup`) 대신 히든 클래스(`hidden class`)라는 방식 사용.
  - 히든 클래스는 `Java`와 같이 고정된 객체 레이아웃(클래스)과 유사하게 동작.

### 변경 가능한 값

> 객체(참조) 타입의 값은 변경 가능한 값(`mutable value`).

- 참조 값(`reference value`)은 생성된 객체가 저장된 메모리 공간의 주소 그 자체.
- 객체를 할당한 변수는 재할당 없이 객체를 직접 변경할 수 있음.
- 객체를 변경할 때마다 복사해서 새롭게 생성한다면 명확하고 신뢰성이 확보되지만, 복사 비용이 늘어 메모리의 효율적 소비가 어렵고 성능이 나빠짐.
- 원시 값과는 다르게 여러 개의 식별자가 하나의 객체를 공유할 수 있음.

#### 얕은 복사(`shallow copy`)와 깊은 복사(`deep copy`)

- 얕은 복사는 한 단계까지만 복사함.
- 깊은 복사는 객체에 중첩되어 있는 객체까지 모두 복사.

### 참조에 의한 전달

- 객체를 가리키는 변수를 다른 변수에 할당하면 원본의 참조 값이 복사되어 전달.

  > 두 개의 식별자가 하나의 객체를 공유한다는 뜻.

- 값에 의한 전달과 참조에 의한 전달은 식별자가 기억하는 메모리 공간에 저장되어 있는 값을 복사해서 전달한다는 면에서 동일.
- 변수에 저장되어 있는 값이 원시 값이냐 참조 값이냐의 차이만 있음.
- 따라서 `JavaScript`에는 참조에 의한 전달은 존재하지 않고 값에 의한 전달만이 존재.
- 공유에 의한 전달(`pass by sharing`)이라고 표현하기도 함.
- `JavaScript`에는 포인터(`pointer`)가 존재하지 않기 때문에 다른 프로그래밍 언어의 참조에 의한 전달과 의미가 다를 수 있음.
